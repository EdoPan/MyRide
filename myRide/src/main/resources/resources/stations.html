<!DOCTYPE html>
<html lang="en">

<head>
	<title>MyRide</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/ionicons.min.css">
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/icomoon.css">
    <link rel="stylesheet" href="css/style.css">

	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

	<script>
		document.addEventListener("DOMContentLoaded", function () {
			if (!(localStorage.hasOwnProperty("username"))) {
			  window.location.href = "login.html";
			}
		});
	</script>

</head>

<body onload="buildPage()">

	<script>
		async function getStations() {
			const STATIONS_ENDPOINT = "http://127.0.0.1:8080/stations/";
			let res = '';
			const queryString = window.location.search;
			const urlParams = new URLSearchParams(queryString);
			const type = urlParams.get("type") == null ? "all" : urlParams.get("type");
			
			await axios.get(STATIONS_ENDPOINT+type)
				.then(response => {
					res = response.data;
				})
				.catch(error => {
					console.error("Error:", error);
				});
			return res;
		}

		function fillPage(stations){
			let mainRow = document.getElementById("main-row");
			stations?.forEach(function (station) {
				let card = document.createElement("div");
				card.className="col-md-4";
				card.innerHTML = `
					<div class="car-wrap rounded ftco-animate fadeInUp ftco-animated">
						<div class="img rounded d-flex align-items-end"
							style="background-image: url(images/bike_station.jpg);">
						</div>
						<div class="text">
							<h2 class="mb-0"><a href="/station.html?id=${station.id}">Station ${station.id}</a></h2>
							<div class="d-flex mb-3">
								<span class="cat">${station.address}</span>
							</div>
							<p class="d-flex mb-0 d-block"></p>
						</div>
					</div>
				`;
				mainRow.appendChild(card);
			});
		}

		async function buildPage(){
			const stations = await getStations();
			fillPage(stations);
		}

	</script>

	<script>
		document.addEventListener("DOMContentLoaded", function () {
			if (localStorage.getItem("isMaintainer") === 'true') {
			document.getElementById("li").innerHTML = `
				<a href="maintainer.html" class="nav-link">Maintainer</a>
			`
			}
		});
  	</script>

	<nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
		<div class="container">
		<a class="navbar-brand" href="index.html">My<span>Ride</span></a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
			<span class="oi oi-menu"></span> Menu
		</button>
		<div class="collapse navbar-collapse" id="ftco-nav">
			<ul class="navbar-nav ml-auto">
			<li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
			<li class="nav-item active"><a href="stations.html" class="nav-link">Stations</a></li>
			<li class="nav-item"><a href="chat.html" class="nav-link">Chat</a></li>
			<li class="nav-item"id="li"></li>
			<li id="logout_nav" class="nav-item"><a class="nav-link">Logout</a></li>
			</ul>
		</div>
		</div>
	</nav>
	<!-- END nav -->

	<section class="hero-wrap hero-wrap-2 js-fullheight" style="background-image: url('images/bg_4.jpg');"
		data-stellar-background-ratio="0.5">
		<div class="overlay"></div>
		<div class="container">
			<div class="row no-gutters slider-text js-fullheight align-items-end justify-content-start">
				<div class="col-md-9 ftco-animate pb-5">
					<h1 class="mb-3 bread">Our Stations</h1>
				</div>
			</div>
		</div>
	</section>

	<section class="ftco-section bg-light">
		<div class="container">
			<div class="row" id="main-row">

			</div>
		</div>
	</section>

	<!-- loader -->
	<div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>

	<script src="js/jquery.min.js"></script>
	<script src="js/jquery-migrate-3.0.1.min.js"></script>
	<script src="js/popper.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.easing.1.3.js"></script>
	<script src="js/jquery.waypoints.min.js"></script>
	<script src="js/jquery.stellar.min.js"></script>
	<script src="js/owl.carousel.min.js"></script>
	<script src="js/jquery.magnific-popup.min.js"></script>
	<script src="js/aos.js"></script>
	<script src="js/jquery.animateNumber.min.js"></script>
	<script src="js/bootstrap-datepicker.js"></script>
	<script src="js/jquery.timepicker.min.js"></script>
	<script src="js/scrollax.min.js"></script>
	<script src="js/main.js"></script>

	<script>
		document.getElementById("logout_nav").addEventListener("click", function (event) {
			event.preventDefault();
			localStorage.removeItem("username");
			localStorage.removeItem("isMaintainer");
			window.location.href = "login.html";
		});
	</script>
	
</body>

</html>